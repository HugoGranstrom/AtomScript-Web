# AtomScript

include "../Proton/Proton.atom";

@currentColor = "%c000000";
@tablesDiv;
@mouseDown = false;
@drawing = true;
@erasing = false;
@replacing = false;
@colorChecker = null;
@tableCount = 0;

$main(){

	Doc::body::style::fontFamily = "Arial, Helvetica, sans-serif";
	
	#@listEl = Proton<createList>(["hallo", "list", Proton<createButton>("BUTTON")::outerHTML], 1);
	
	@btn = Proton<createButton>("Make canvas");
	btn<onclick> = makeTable;
	
	@colorInput = Proton<createTextInput>();
	colorInput::style<display> = "inline";
	colorInput::style<padding> = "5px";
	colorInput<setText>(currentColor);
	colorInput::style<color> = currentColor;
	colorInput::style<border> = "1px solid %c000";
	colorInput::style<margin> = "10px";
	
	@drawTool = Proton<createButton>("Draw");
	drawTool<onclick> = $(){
	
		if(erasing)erasing = false;
		if(replacing)replacing = false;
		if(!drawing)drawing = true;
	
	}
	
	@eraseTool = Proton<createButton>("Erase");
	eraseTool<onclick> = $(){
	
		if(!erasing)erasing = true;
		if(replacing)replacing = false;
		if(drawing)drawing = false;
	
	}
	
	@replaceTool = Proton<createButton>("Replace");
	replaceTool<onclick> = $(){
	
		if(erasing)erasing = false;
		if(!replacing)replacing = true;
		if(drawing)drawing = false;
	
	}
	
	tablesDiv = Proton<createDiv>();
	tablesDiv::style<backgroundColor> = "%cf2f2f2";
	tablesDiv::style<padding> = "15px";
	tablesDiv::style<margin> = "15px";
		
	Proton<append>(btn);
	Proton<append>(colorInput);
	Proton<append>(drawTool);
	Proton<append>(eraseTool);
	Proton<append>(replaceTool);
	Proton<append>(tablesDiv);
	#Proton<append>(listEl);
	
	@checkColor = $(){
	
		currentColor = colorInput<getText>();
		
	};
	
	colorChecker = Window<setInterval>(checkColor, 300);
	
}

$makeTable(){

	tableCount++;
	@c = parseInt(prompt("Columns?"));
	@r = parseInt(prompt("Rows?"));
	@table = Proton<createTable>(c, r);	
	table<applyToCells>(createCell);
	
	table::style::backgroundColor = "black";
	table::style::margin = "10px";
	table::style::borderSpacing = "0";
	table::class = "Canvas" + tableCount;
	
	Proton<append>(table, tablesDiv);
	console<log>(table<rowCount>);
	
	return table;

}

$randomInt(min, max){

    return Math<floor>((Math<random>() * max) + min);

}

$getRandomColor() {
    @letters = "0123456789ABCDEF"::split("");
    @color = "%c";
    for (@i = 0; i < 6; i++ ) {
        color += letters[randomInt(0, 16)];
    }
    return color;
}

$createCell(cell){

	cell::style::backgroundColor = "%cfff";
	cell::style::textAlign = "center";
	cell::style::width = "5px";
	cell::style::height = "5px";
	cell::style::cursor = "pointer";
	cell::style::margin = "0";
	cell::class = "unselectable " + "Canvas" + tableCount;
	cell<addEventListener>("click", $(){
	
		if(drawing)cell::style::backgroundColor = currentColor;
		else if(erasing)cell::style::backgroundColor = "%cfff";
		else if(replacing)replace(Proton<get>(cell<class>)[0], cell);
	
	});
	cell<addEventListener>("mousedown", $(){
	
		mouseDown = true;
		if(mouseDown){
		
			if(drawing)cell::style::backgroundColor = currentColor;
			else if(erasing)cell::style::backgroundColor = "%cfff";
		
		}
		console<log>(mouseDown);
	
	});
	cell<addEventListener>("mouseup", $(){
	
		mouseDown = false;
		console<log>(mouseDown);
	
	});
	cell<addEventListener>("mouseover", $(){
	
		if(mouseDown){
		
			if(drawing)cell::style::backgroundColor = currentColor;
			else if(erasing)cell::style::backgroundColor = "%cfff";
		
		}
	
	});

}

$replace(table, cell){

	@cellColor = cell::style<backgroundColor>;
	for(@r = 0; i < table::cells::length; i++){
		
		if(cell::style<backgroundColor> == cellColor){
		
			table::cells[i]::style<backgroundColor> = currentColor;
		
		}
		
	}

}